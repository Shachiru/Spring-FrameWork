<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 900px;
            margin-top: 30px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn-action {
            margin-right: 5px;
        }
        .table-responsive {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="text-center mb-4">Item Management System</h1>

    <!-- Item Form Card -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 id="formTitle">Add New Item</h5>
        </div>
        <div class="card-body">
            <form id="itemForm">
                <div class="mb-3">
                    <label for="itemId" class="form-label">Item ID</label>
                    <input type="number" class="form-control" id="itemId" required>
                </div>
                <div class="mb-3">
                    <label for="itemDescription" class="form-label">Description</label>
                    <input type="text" class="form-control" id="itemDescription" required>
                </div>
                <div class="mb-3">
                    <label for="itemQuantity" class="form-label">Quantity</label>
                    <input type="number" class="form-control" id="itemQuantity" required>
                </div>
                <div class="mb-3">
                    <label for="itemPrice" class="form-label">Unit Price</label>
                    <input type="number" step="0.01" class="form-control" id="itemPrice" required>
                </div>
                <div class="d-flex justify-content-end">
                    <button type="button" id="clearBtn" class="btn btn-secondary me-2">Clear</button>
                    <button type="submit" id="saveBtn" class="btn btn-primary">Save Item</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Item List Card -->
    <div class="card">
        <div class="card-header bg-info text-white">
            <h5>Item List</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Description</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="itemTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function () {
    const baseUrl = "http://localhost:8080/api/v1/item";

    loadItems();

    $("#itemForm").submit(function (e) {
      e.preventDefault();
      const itemData = {
        id: $("#itemId").val(),
        description: $("#itemDescription").val(),
        quantity: $("#itemQuantity").val(),
        price: $("#itemPrice").val()
      };

      $.ajax({
        url: baseUrl + "/save",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify(itemData),
        success: function () {
          loadItems();
          clearForm();
          showAlert("Item saved successfully!", "success");
        },
        error: function (xhr) {
          showAlert("Error: " + xhr.responseText, "error");
        }
      });
    });

    function loadItems() {
      $.ajax({
        url: baseUrl + "/getall",
        type: "GET",
        success: function (response) {
          $("#itemTableBody").empty();
          $.each(response.data, function (index, item) {
            let row = `<tr onclick="selectItem(${item.id}, '${item.description}', ${item.quantity}, ${item.price})">
                                    <td>${item.id}</td>
                                    <td>${item.description}</td>
                                    <td>${item.quantity}</td>
                                    <td>${item.price}</td>
                                    <td>
                                        <button class='btn btn-warning btn-sm' onclick='editItem(${item.id})'>Edit</button>
                                        <button class='btn btn-danger btn-sm' onclick='deleteItem(${item.id})'>Delete</button>
                                    </td>
                                </tr>`;
            $("#itemTableBody").append(row);
          });
        },
        error: function (xhr) {
          showAlert("Error loading items: " + xhr.responseText, "error");
        }
      });
    }

    $("#clearBtn").click(function () {
      clearForm();
    });

    function clearForm() {
      $("#itemForm")[0].reset();
      $("#itemId").prop("readonly", false);
    }

    window.deleteItem = function (id) {
      if (confirm("Are you sure you want to delete this item?")) {
        $.ajax({
          url: baseUrl + "/delete/" + id,
          type: "DELETE",
          success: function () {
            loadItems();
            showAlert("Item deleted successfully!", "success");
          },
          error: function (xhr) {
            showAlert("Error: " + xhr.responseText, "error");
          }
        });
      }
    };

    window.selectItem = function (id, description, quantity, price) {
      $("#itemId").val(id).prop("readonly", true);
      $("#itemDescription").val(description);
      $("#itemQuantity").val(quantity);
      $("#itemPrice").val(price);
    };

    function showAlert(message, type) {
      let alertBox = $("#alertBox");
      alertBox.text(message).show();
      alertBox.removeClass().addClass("alert alert-" + (type === "success" ? "success" : "danger"));
      setTimeout(() => {
        alertBox.fadeOut();
      }, 2000);
    }
  });

</script>
</body>
</html>
