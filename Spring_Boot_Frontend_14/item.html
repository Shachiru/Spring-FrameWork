<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 900px;
            margin-top: 30px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn-action {
            margin-right: 5px;
        }
        .table-responsive {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="text-center mb-4">Item Management System</h1>

    <!-- Item Form Card -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 id="formTitle">Add New Item</h5>
        </div>
        <div class="card-body">
            <form id="itemForm">
                <div class="mb-3">
                    <label for="itemId" class="form-label">Item ID</label>
                    <input type="number" class="form-control" id="itemId" required>
                </div>
                <div class="mb-3">
                    <label for="itemDescription" class="form-label">Description</label>
                    <input type="text" class="form-control" id="itemDescription" required>
                </div>
                <div class="mb-3">
                    <label for="itemQuantity" class="form-label">Quantity</label>
                    <input type="number" class="form-control" id="itemQuantity" required>
                </div>
                <div class="mb-3">
                    <label for="itemPrice" class="form-label">Unit Price</label>
                    <input type="number" step="0.01" class="form-control" id="itemPrice" required>
                </div>
                <div class="d-flex justify-content-end">
                    <button type="button" id="clearBtn" class="btn btn-secondary me-2">Clear</button>
                    <button type="submit" id="saveBtn" class="btn btn-primary">Save Item</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Item List Card -->
    <div class="card">
        <div class="card-header bg-info text-white">
            <h5>Item List</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Description</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="itemTableBody">
                    <!-- Item data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>
    const API_URL = 'http://localhost:8080/api/v1/item';

    document.addEventListener('DOMContentLoaded', loadItems);
    document.getElementById('itemForm').addEventListener('submit', handleFormSubmit);
    document.getElementById('clearBtn').addEventListener('click', resetForm);

    function loadItems() {
        fetch(`${API_URL}/getAll`)
            .then(response => response.json())
            .then(items => renderItemTable(items))
            .catch(() => alert('Failed to load items.'));
    }

    function renderItemTable(items) {
        const tableBody = document.getElementById('itemTableBody');
        tableBody.innerHTML = '';
        if (items.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No items found</td></tr>';
            return;
        }
        items.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.id}</td>
                <td>${item.description}</td>
                <td>${item.quantity}</td>
                <td>${item.unitPrice}</td>
                <td>
                    <button class="btn btn-sm btn-warning edit-btn" data-id="${item.id}">Edit</button>
                    <button class="btn btn-sm btn-danger delete-btn" data-id="${item.id}">Delete</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        document.querySelectorAll('.edit-btn').forEach(btn => btn.addEventListener('click', handleEditClick));
        document.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', handleDeleteClick));
    }

    function handleFormSubmit(event) {
        event.preventDefault();
        const itemData = {
            id: parseInt(document.getElementById('itemId').value),
            description: document.getElementById('itemDescription').value,
            quantity: parseInt(document.getElementById('itemQuantity').value),
            unitPrice: parseFloat(document.getElementById('itemPrice').value)
        };
        fetch(`${API_URL}/save`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(itemData)
        })
            .then(response => response.json())
            .then(() => {
                resetForm();
                loadItems();
                alert('Item saved successfully!');
            })
            .catch(() => alert('Error saving item.'));
    }

    function handleEditClick(event) {
        const row = event.target.closest('tr');
        document.getElementById('itemId').value = row.cells[0].textContent;
        document.getElementById('itemDescription').value = row.cells[1].textContent;
        document.getElementById('itemQuantity').value = row.cells[2].textContent;
        document.getElementById('itemPrice').value = row.cells[3].textContent;
        document.getElementById('formTitle').textContent = 'Edit Item';
        document.getElementById('saveBtn').textContent = 'Update Item';
    }

    function handleDeleteClick(event) {
        const id = event.target.dataset.id;
        if (confirm(`Are you sure you want to delete item #${id}?`)) {
            fetch(`${API_URL}/delete/${id}`, { method: 'DELETE' })
                .then(() => {
                    loadItems();
                    alert('Item deleted successfully!');
                })
                .catch(() => alert('Error deleting item.'));
        }
    }

    function resetForm() {
        document.getElementById('itemForm').reset();
        document.getElementById('formTitle').textContent = 'Add New Item';
        document.getElementById('saveBtn').textContent = 'Save Item';
    }
</script>
</body>
</html>
