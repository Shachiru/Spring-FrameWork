<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container mt-5">
<h2 class="text-center mb-4">Customer Management</h2>

<form id="customerForm" class="mb-3">
  <div class="row g-2">
    <div class="col-md-3">
      <input type="number" id="id" class="form-control" placeholder="Customer ID" required>
    </div>
    <div class="col-md-4">
      <input type="text" id="name" class="form-control" placeholder="Customer Name" required>
    </div>
    <div class="col-md-4">
      <input type="text" id="address" class="form-control" placeholder="Customer Address" required>
    </div>
    <div class="col-md-1">
      <button type="submit" class="btn btn-primary">Save</button>
    </div>
  </div>
</form>

<button class="btn btn-success mb-3" id="loadCustomers">Load Customers</button>

<table class="table table-striped table-bordered">
  <thead class="table-dark">
  <tr>
    <th>ID</th>
    <th>Name</th>
    <th>Address</th>
    <th>Actions</th>
  </tr>
  </thead>
  <tbody id="customerTableBody"></tbody>
</table>

<script>
  $(document).ready(function () {
    const baseUrl = "http://localhost:8080/api/v1/customer";

    loadCustomers();

    $("#customerForm").submit(function (event) {
      event.preventDefault();
      let customer = {
        id: $("#id").val(),
        name: $("#name").val(),
        address: $("#address").val()
      };

      $.ajax({
        url: baseUrl + "/save",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify(customer),
        success: function () {
          loadCustomers();
          alert("Customer saved successfully!");
        },
        error: function (xhr) {
          alert("Error: " + xhr.responseText);
        }
      });
    });

    function loadCustomers() {
      $.ajax({
        url: baseUrl + "/getAll",
        type: "GET",
        success: function (response) {
          $("#customerTableBody").empty();
          $.each(response.data, function (index, customer) {
            let row = `<tr>
                          <td>${customer.id}</td>
                          <td>${customer.name}</td>
                          <td>${customer.address}</td>
                          <td>
                              <button class='btn btn-warning btn-sm' onclick='editCustomer(${customer.id})'>Edit</button>
                              <button class='btn btn-danger btn-sm' onclick='deleteCustomer(${customer.id})'>Delete</button>
                          </td>
                        </tr>`;
            $("#customerTableBody").append(row);
          });
        },
        error: function (xhr) {
          alert("Error loading customers: " + xhr.responseText);
        }
      });
    }

    $("#loadCustomers").click(function () {
      loadCustomers();
    });

    window.deleteCustomer = function (id) {
      if (confirm("Are you sure you want to delete this customer?")) {
        $.ajax({
          url: baseUrl + "/delete/" + id,
          type: "DELETE",
          success: function () {
            loadCustomers();
            alert("Customer deleted successfully!");
          },
          error: function (xhr) {
            alert("Error: " + xhr.responseText);
          }
        });
      }
    };

    window.editCustomer = function (id) {
      let newName = prompt("Enter new name:");
      let newAddress = prompt("Enter new address:");
      if (!newName || !newAddress) return;

      let customer = { id, name: newName, address: newAddress };

      $.ajax({
        url: baseUrl + "/update",
        type: "PUT",
        contentType: "application/json",
        data: JSON.stringify(customer),
        success: function () {
          loadCustomers();
          alert("Customer updated successfully!");
        },
        error: function (xhr) {
          alert("Error: " + xhr.responseText);
        }
      });
    };
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
